/*! 2024-11-03 */
KISSY.add(function(u,i,t,e,s,n){function p(i){i=u.mix(i||{},{defaultIndex:0,animation:"slide",direction:"horizontal",autoSlide:!1,timeout:3e3,loop:!1,activeCls:"active",colspan:1},!1),this.lazyLoadArr=[],p.superclass.constructor.call(this,i)}return u.extend(p,s),UFO.augment(p,{alias:"slider",initComponent:function(){var i;this.el||(this.el=u.all(n)),"vertical"==this.direction?this.el.addClass("slider-vertical"):this.el.addClass("slider-horizontal"),this.sliderWrapper=this.el.one(".slider-wrapper"),this.sliderPagination=this.getSliderPagination(),this.sliderContainer?u.isString(this.sliderContainer)&&(this.sliderContainer=u.one(this.sliderContainer)):this.sliderContainer=u.one(document.body),u.isString(this.sliderContainer)&&(i=u.one("#"+this.sliderContainer),this.sliderContainer=i||u.one(this.sliderContainer)),p.superclass.initComponent.apply(this,arguments),this.init()},fixForTransitionWhenLoop:function(){var i=this.sliderSlides.item(0).clone(!0),t=this.sliderSlides.item(this.sliderSlides.length-1).clone(!0);this.sliderWrapper.append(i),this.sliderWrapper.prepend(t),this.sliderSlides=this.el.all(".slider-slide")},init:function(){this.sliderSlides=this.el.all(".slider-wrapper .slider-slide"),this.slidesLength=this.items.length,this.loop&&(this.fixForTransitionWhenLoop(),this.slidesLength=this.items.length+2),this.setSliderSize(),this.setDefaultIndex(this.defaultIndex),1<this.items.length&&this.autoSlide&&this.play()},setDefaultIndex:function(i){this.loop&&i++,this.go(i,"none")},getBodyContainer:function(){return this.sliderWrapper},setSliderSize:function(){"vertical"==this.direction?(this.slideSize=this.sliderContainer.innerHeight(),this.el.all(".slider-slide").css("height",this.slideSize)):(this.slideSize=this.sliderContainer.innerWidth(),this.sliderWrapper.width(this.slideSize*this.slidesLength),this.el.all(".slider-slide").css("width",this.slideSize))},add:function(i,t){if(!u.isEmptyObject(i)){u.isArray(i)||(i=[i]);var e,s,n,a=this,r=a.items?a.items.length:0,l=(i.length,1<r+i.length);1===r&&l&&a.sliderPagination.append(a.createSliderPaginationBullet(a.items[0],0));for(var o,d,h=0,c=i.length;h<c;h++)e=i[h],s=u.one('<div class="slider-slide" data-index="'+(r+h)+'">'),a.slideCls&&s.addClass(a.slideCls),a.lazyLoad?a.lazyLoadArr.push({content:e}):(n=UFO.createItem(e,a.defaults),s.append(n.getEl?n.getEl():n)),i[h]=s,l&&a.sliderPagination.append(a.createSliderPaginationBullet(e),r+h);return this.loop&&(o=u.clone(a.lazyLoadArr[0]),d=u.clone(a.lazyLoadArr[a.lazyLoadArr.length-1]),a.lazyLoadArr.splice(0,0,d),a.lazyLoadArr.push(o)),p.superclass.add.apply(this,arguments)}},slideTo:function(i,t,e){function s(){e&&e.call(n,n)}var n=this;u.isFunction(t)&&(e=t,t=this.animation),t=t||n.animation;({horizontal:{none:function(i){n.sliderWrapper.css({"-webkit-transition-duration":"0s","transition-duration":"0s","-webkit-transform":"translate3d("+-1*i*n.slideSize+"px,0,0)",transform:"translate3d("+-1*i*n.slideSize+"px,0,0)","-webkit-backface-visibility":"hidden","backface-visibility":"hidden",opacity:1}),s()},slide:function(i){n.sliderWrapper.css({"-webkit-transition-duration":"300ms","transition-duration":"300ms","-webkit-transform":"translate3d("+-1*i*n.slideSize+"px,0,0)",transform:"translate3d("+-1*i*n.slideSize+"px,0,0)","-webkit-backface-visibility":"hidden","backface-visibility":"hidden",opacity:1}),setTimeout(function(){s()},300)}},vertical:{none:function(i){n.sliderWrapper.css({"-webkit-transition-duration":"0s","transition-duration":"0s","-webkit-transform":"translate3d(0,"+-1*i*n.slideSize+"px,0)",transform:"translate3d(0,"+-1*i*n.slideSize+"px,0)","-webkit-backface-visibility":"hidden","backface-visibility":"hidden",opacity:1}),s()},slide:function(i){n.sliderWrapper.css({"-webkit-transition-duration":"300ms","transition-duration":"300ms","-webkit-transform":"translate3d(0,"+-1*i*n.slideSize+"px,0)",transform:"translate3d(0,"+-1*i*n.slideSize+"px,0)","-webkit-backface-visibility":"hidden","backface-visibility":"hidden",opacity:1}),setTimeout(function(){s()},300)}}})[n.direction][t](i)},go:function(i,t,e){var s;return u.isFunction(t)&&(e=t,t=this.animation),t=t||this.animation,i>=this.slidesLenght&&(i%=this.slidesLenght),i!=this.index&&(this.index=i,s=this.getRealIndex(i),this.lazyLoad&&!this.lazyLoadArr[i].loaded&&this.load(this.el.one(".slider-wrapper .slider-slide:nth-child("+(i+1)+")"),i,this.lazyLoadArr[i].content),this.slideTo(i,t,e),this.hightlightPagerBullet(s)),this},load:function(i,t,e){u.isString(e)?i.append(e):i.append(UFO.createItem(e).getEl()),this.lazyLoadArr[t].loaded=!0},getNextIndex:function(){var i=this.index+1;return i>=this.slidesLength&&(i%=this.slidesLength),i},getPreIndex:function(){var i=this.index+this.slidesLength-1;return i>=this.slidesLength&&(i%=this.slidesLength),i},next:function(i){var t=this;return t.slidesLength<2?i&&i.call(t):t.go(t.getNextIndex(),function(){if(t.loop&&t.isLast())return t.fixNextLoop(),this;i&&i.call(t)}),this},previous:function(i){var t=this;return t.slidesLength<2?i&&i.call(t):t.go(t.getPreIndex(),function(){if(t.loop&&t.isFirst())return t.fixPreLoop(),this;i&&i.call(t)}),this},isLast:function(){return this.index===this.slidesLength-1},isFirst:function(){return 0===this.index},fixNextLoop:function(){this.go(1,"none")},fixPreLoop:function(){this.go(this.slidesLength-2,"none")},play:function(){var i=this;return null!==i.timer&&clearTimeout(i.timer),i.timer=setTimeout(function(){i.next().play()},Number(i.timeout)),i.stoped=!1,this},stop:function(){var i=this;return clearTimeout(i.timer),i.timer=null,i.stoped=!0,this},getRealIndex:function(i){var t=this,e=i;return e=t.loop?0==i?t.items.length-1:i==t.slidesLength-1?0:i-1:e},addCmpEvents:function(){var n=this;p.superclass.addCmpEvents.apply(this,arguments),this.el.delegate("touchstart mousedown",".slider-slide",function(i){console.log("mousedown= ",i),n.stop(),n.touching=!0,n.sliderWrapper.css({"-webkit-transition-duration":"0s","transition-duration":"0s"}),n.startX=(i.changedTouches?i.changedTouches[0]:i).clientX,n.startY=(i.changedTouches?i.changedTouches[0]:i).clientY,n.startPos="horizontal"==n.direction?n.startX:n.startY,n.startT=(new Date).getTime()}),this.el.delegate("touchend mouseup",".slider-slide",function(i){console.log("mouseup= ",i),n.touching=!1;var t=(i.changedTouches?i.changedTouches[0]:i).clientX,i=(i.changedTouches?i.changedTouches[0]:i).clientY,e="horizontal"==n.direction?t:i,e=(n.delta=Math.abs(e-n.startPos),Math.abs(e)<Math.abs(n.startPos)),s=!e,s=!n.loop&&(n.isLast()&&e||n.isFirst()&&s),i=Math.abs(n.delta)<Math.abs("horizontal"==n.direction?i-n.startY:t-n.startX);s||i||!(n.delta>n.slideSize/2||(new Date).getTime()-n.startT<550&&10<n.delta)?n.slideTo(n.index):e?n.next():n.previous(),n.autoSlide&&n.stoped&&n.play()}),this.el.delegate("touchmove mousemove",".slider-slide",function(i){var t,e;return!n.touching||(e=n.slideSize,i.touches&&1<i.touches.length?void 0:(t=(i.touches?i.touches[0]:i).clientX,i=(i.touches?i.touches[0]:i).clientY,n.delta="horizontal"==n.direction?t-n.startPos:i-n.startPos,!n.loop&&(n.isLast()&&n.delta<0||n.isFirst()&&0<n.delta)&&(n.delta=n.delta/3),Math.abs(n.delta)<Math.abs("horizontal"==n.direction?i-n.startY:t-n.startX)||(n.stop(),i=n.delta-n.index*e,n.lazyLoad&&n.delta<0&&(t=n.getNextIndex(),n.lazyLoadArr[t]||console.log("lazyLoadArr",n.lazyLoadArr,t),n.lazyLoadArr[t].loaded||n.load(n.el.one(".slider-wrapper .slider-slide:nth-child("+(t+1)+")"),t,n.lazyLoadArr[t].content)),n.lazyLoad&&0<n.delta&&(e=n.getPreIndex(),n.lazyLoadArr[e]||console.log("lazyLoadArr==",n.lazyLoadArr,e),n.lazyLoadArr[e].loaded||n.load(n.el.one(".slider-wrapper .slider-slide:nth-child("+(e+1)+")"),e,n.lazyLoadArr[e].content)),"horizontal"==n.direction?n.sliderWrapper.css({"-webkit-transition-duration":"0s","transition-duration":"0s","-webkit-transform":"translate3d("+i+"px,0,0)",transform:"translate3d("+i+"px,0,0)"}):n.sliderWrapper.css({"-webkit-transition-duration":"0s","transition-duration":"0s","-webkit-transform":"translate3d(0,"+i+"px,0)",transform:"translate3d(0,"+i+"px,0)"}),!1)))}),t.on(window,"resize",function(i){n.setSliderSize(),n.slideTo(n.index,"none")}),this.el.delegate("click tap",".tabbar .tab",function(i){i=u.one(i.currentTarget),i=u.all(".tabbar .tab").index(i);return n.go(i),!1})},getSliderPagination:function(){return this.el.one(".slider-pagination")},createSliderPaginationBullet:function(i,t){return'<span class="slider-pagination-bullet"></span>'},hightlightPagerBullet:function(i){this.sliderPagination.all(".slider-pagination-bullet").removeClass(this.activeCls);i=this.sliderPagination.one(".slider-pagination-bullet:nth-child("+(i+1)+")");i&&i.addClass(this.activeCls)}}),p},{requires:["node","event","xtemplate","../container/Container","./tpl/slider-tpl"]});