/*! 2024-11-04 */
KISSY.add("UFO/EventSupport",function(a){function b(a,b){for(var c=0,d=b.length;d>c;c++){for(var e=b[c],f=0,g=0;f<a.length;f++)a[f]!=e&&(a[g++]=a[f]);a.length=g}}function c(a){this.listeners=this.listeners||{},this.oneTimeListeners=this.oneTimeListeners||{}}return UFO.augment(c,{on:function(b,c){var d=this.listeners[b]||[];return(d=a.isArray(d)?d:[d]).push(c),this.listeners[b]=d,this},off:function(a,c){return this.listeners[a]&&b(this.listeners[a],c),this.oneTimeListeners[a]&&b(this.oneTimeListeners[a],c),this},one:function(a,b){return this.oneTimeListeners[a]=this.oneTimeListeners[a]||[],this.oneTimeListeners[a].push(b),this},fire:function(){var b=[],c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=this.listeners[c],f=this.oneTimeListeners[c];if(e)for(var g=0,h=(e=a.isArray(e)?e:[e]).length;h>g;g++)b.push(e[g].apply(this,d));if(f)for(g=0,h=(f=a.isArray(f)?f:[f]).length;h>g;g++)b.push(f[g].apply(this,d));return f=[],1==b.length?b[0]:b},fireEvent:function(){return this.fire.apply(this,arguments)},hasListener:function(a){return this.listeners[a]},relayEvents:function(a,b,c){for(var d,e=b.length,f=0;e>f;f++)d=b[f],a.on(d,this.createRelayer(c?c+d:d))},createRelayer:function(a,b){var c=this;return function(){return c.fireEvent.apply(c,[a].concat(Array.prototype.slice.apply(arguments,b||[0])))}}}),c}),KISSY.add("UFO/ComponentQuery",function(a){function b(a,b){return b.method.apply(this,[a].concat(b.args))}function c(a,b){for(var c,d=[],e=0,f=a.length,g=">"!==b;f>e;e++)(c=a[e]).getRefItems&&(d=d.concat(c.getRefItems(g)));return d}function d(a,b,c){if("*"===b)return a.slice();for(var d,e=[],f=0,g=a.length;g>f;f++)(d=a[f])&&d.isType&&d.isType(b,c)&&e.push(d);return e}function e(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)(c=a[e]).hasCls(b)&&d.push(c);return d}function f(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)(c=a[e]).getId()===b&&d.push(c);return d}var g=this,h=/^(\s?([>\^])\s?|\s|$)/,i=/^(#)?([\w\-]+|\*)(?:\((true|false)\))?/,j=[{re:/^\.([\w\-]+)(?:\((true|false)\))?/,method:d},{re:/^(?:[\[](?:@)?([\w\-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]])/,method:function(a,b,c,d){for(var e,f=[],g=0,h=a.length;h>g;g++)e=a[g],(d?String(e[b])===d:e[b])&&f.push(e);return f}},{re:/^#([\w\-]+)/,method:f},{re:/^\:([\w\-]+)(?:\(((?:\{[^\}]+\})|(?:(?!\{)[^\s>\/]*?(?!\})))\))?/,method:function(a,b,c){return g.pseudos[b](a,c)}}],k=(g.Query=function(a){a=a||{},UFO.apply(this,a)},UFO.augment(g.Query,{execute:function(d){var e,f,g=this.operations,h=0,i=g.length;for(a.isArray(d)&&(f=d);i>h;h++)if(f="^"===(e=g[h]).mode?function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)for(b=a[d];b=b.ownerCt||b.floatParent;)c.push(b);return c}(f||[d]):e.mode?c(f||[d],e.mode):b(f||c([d]),e),h===i-1)return f;return[]},is:function(c){var d,e,f=this.operations,g=a.isArray(c)?c:[c],c=g.length,h=f[f.length-1];if((g=b(g,h)).length!==c)return!1;if(1<f.length)for(e=0,d=g.length;d>e;e++)if(-1===a.indexOf(this.execute(),g[e]))return!1;return!0}}),{cache:{},pseudos:{not:function(a,b){for(var c,d=k,e=0,f=a.length,g=[],h=-1;f>e;++e)c=a[e],d.is(c,b)||(g[++h]=c);return g},first:function(a){var b=[];return 0<a.length&&b.push(a[0]),b},last:function(a){var b=a.length,c=[];return b>0&&c.push(a[b-1]),c}},query:function(b,c){for(var d,e,f,g=b.split(","),h=g.length,i=0,j=[],k=[],l={};h>i;i++)b=a.trim(g[i]),d=this.cache[b]||(this.cache[b]=this.parse(b)),j=j.concat(d.execute(c));if(1<(e=j.length)){for(i=0;e>i;i++)f=j[i],console.log("cmp.id",f.id),l[f.id]||(k.push(f),l[f.id]=!0);j=k}return j},is:function(b,c){if(!c)return!0;for(var d=c.split(","),e=d.length,f=0;e>f;f++)if(c=a.trim(d[f]),(this.cache[c]||(this.cache[c]=this.parse(c))).is(b))return!0;return!1},parse:function(b){for(var c,k,l,m,n,o,p,q=[],r=j.length;b&&c!==b;){for((k=(c=b).match(i))&&(l=k[1],q.push("#"===l?{method:f,args:[a.trim(k[2])]}:"."===l?{method:e,args:[a.trim(k[2])]}:{method:d,args:[a.trim(k[2]),Boolean(k[3])]}),b=b.replace(k[0],""));!(m=b.match(h));)for(o=0;b&&r>o;o++){if(p=j[o],n=b.match(p.re),p.method,n){q.push({method:p.method,args:n.slice(1)}),b=b.replace(n[0],"");break}o===r-1&&console.error('Invalid ComponentQuery selector: "'+arguments[0]+'"')}m[1]&&(q.push({mode:m[2]||m[1]}),b=b.replace(m[0],""))}return new g.Query({operations:q})}});return k}),KISSY.add("UFO/Component",function(a,b,c,d){function e(b){this.config=b||{},a.mix(this,b,!0,void 0,!0),this.id=a.guid(),this.tplId&&(f=this.tpl=a.one("#"+this.tplId).html()),e.superclass.constructor.call(this,b),this.initComponent()}var f="<div></div>";return a.extend(e,c),UFO.augment(e,{alias:"component",initComponent:function(){this.el||(f=this.tpl||f,this.el=a.all(f)),this.bodyStyle=a.mix(this.bodyStyle||{},{padding:this.bodyPadding},!0),this.getBodyContainer().css(this.bodyStyle),this.style=a.mix(this.style||{},{padding:this.padding,margin:this.margin}),this.el.css(this.style),this.cls&&this.addClass(this.cls),this.bodyCls&&this.getBodyContainer().addClass(this.bodyCls),this.attributes&&this.el.attr(this.attributes),this.addCmpEvents()},setSize:function(a,b){this.el.width(a),this.el.height(b)},toEl:function(){return this.el},getEl:function(){return this.toEl()},getTargetEl:function(){},getBodyContainer:function(){return this.el},getContentTarget:function(){return this.el},render:function(b){(b="string"==typeof b?(b=a.one("#"+b))||a.one(b):b).append(this.toEl()),this.fire("afterrender",this)},onAdded:function(a,b){var c=this;c.ownerCt=a,c.fireEvent("added",c,a,b)},css:function(b,c){var d=Array.prototype.slice.call(arguments,0);return 1===d.length&&a.isString(d[0])?el.css(b):this.el.css(b,c),this},removeClass:function(a){return this.el.removeClass(a),this},addClass:function(a){return this.el.addClass(a),this},hasClass:function(a){return this.el.hasClass(a)},hasCls:function(a){return this.hasClass(a)},setDisabled:function(a){(this.disabled=a)?this.el.attr("disabled","disabled"):this.el.attr("disabled","")},show:function(){return!1!==this.fire("beforeshow")&&(this.el.show(),this.fire("show")),this},hide:function(a){var b=this;return!1!==this.fire("beforehide")&&(this.el.hide(),b.destroy&&(b.el.remove(),delete b),b.fire("hide"),a)&&a(),this},getRootContainer:function(){return this.rootContainer},getId:function(){return this.id},up:function(a){var b=this.getBubbleTarget();if(a)for(;b;b=b.getBubbleTarget())if(d.is(b,a))return b;return b},getBubbleTarget:function(){return this.ownerCt},addCmpEvents:function(){},set:function(a,b){this[a]=b},get:function(a){return this[a]},isType:function(a){return UFO.isType(this,a)}}),e},{requires:["node","./EventSupport","./ComponentQuery"]}),KISSY.add("UFO/util/Form",function(a,b){return{getRecord:function(b){a.isString("form")&&(b=a.one(b));var c={};return b.all("input[type=text], input[type=radio]:checked, select, textfield, textarea").each(function(a,b){var d=a.attr("data-type"),e=a.attr("data-value")||a.val();null!=e&&(d&&"NUMBER"==d.toUpperCase()&&(e=Number(e)),c[a.attr("name")]=e)}),c},loadRecord:function(a,b){b=b||{},a.find("input[type=text], select").each(function(a,c){a.val(b($this.attr("name")))})}}},{requires:["node"]}),KISSY.add("UFO/util/Storage",function(a,b){return{setItem:function(a,b,c){var d=typeof c;"string"==d||"number"==d||"boolean"==d?a.setItem(b,c):a.setItem(b,JSON.stringify(c))},getItem:function(a,b){a=a.getItem(b);try{return JSON.parse(a)}catch(b){return a}},setLocalItem:function(a,b){this.setItem(localStorage,a,b)},getLocalItem:function(a){return this.getItem(localStorage,a)},setSessionItem:function(a,b){this.setItem(sessionStorage,a,b)},getSessionItem:function(a){return this.getItem(sessionStorage,a)}}},{requires:["node"]}),KISSY.add("APP/util/ParamUtil",function(a){return{processParam:function(b){for(var c in b){var d=b[c];a.isArray(d)&&(b[c]=d[0])}return b},packParam:function(b){return a.unparam(b.substring(b.indexOf("?")+1))}}}),KISSY.add("APP/app",function(a,b,c){var d="2.9.5",e=c.processParam(a.unparam(decodeURIComponent(location.search.slice(1)))),f=navigator.userAgent.toLowerCase(),g=f.match(/(hlj-\w+)\/(\d\.\d\.\d)/i),h="hlj_customer_position",i="hlj_user",j=void 0,k=void 0,l=[{name:"北京市",code:"110100"},{name:"上海市",code:"310100"},{name:"杭州市",code:"330100"},{name:"成都市",code:"510100"},{name:"深圳市",code:"440300"},{name:"广州市",code:"440100"},{name:"武汉市",code:"420100"},{name:"南京市",code:"320100"},{name:"天津市",code:"120100"},{name:"重庆市",code:"500100"}],m={apiHost:"//app.helijia.com",baseUrl:"//app.helijia.com/zmw"},n={imgBaseUrl:"../",version:d};a.mix(n,m);var o={config:n,getCookie:function(a){var b;return document.cookie.length>0&&(b=document.cookie.indexOf(a+"="),-1!=b)?(b=b+a.length+1,c_end=document.cookie.indexOf(";",b),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(b,c_end))):""},getCity:function(a){return this.getCityMap()[a]||this.getCityMap()[110100]},getCityByName:function(a){return/市$/.test(a)||(a+="市"),this.getNameKeyCityMap()[a]||this.getNameKeyCityMap()["北京市"]},getCityMap:function(){if(!j){j={};for(var a,b=0,c=l.length;c>b;b++)a=l[b],j[a.code]=a}return j},getNameKeyCityMap:function(){if(!k){k={};for(var a,b=0,c=l.length;c>b;b++)a=l[b],k[a.name]=a}return k},getCityList:function(a){return a&&a(result),l},setPosition:function(a){console.log("setPosition",a),a.city_code||(a.city_code=this.getCityByName(a.city).code),b.setSessionItem(h,a)},getPosition:function(){b.getSessionItem(h)},setSessionUser:function(a){b.setSessionItem(i,a)},getSessionUser:function(){return b.getSessionItem(i)},isLogined:function(){return!!this.getSessionUser()},getParam:function(){return e},isApp:function(){return g&&("hlj-ios"==g[1]||"hlj-android"==g[1])},isAdroidApp:function(){return g&&"hlj-android"==g[1]},isIosApp:function(){return g&&"hlj-ios"==g[1]},getAppVersion:function(){return g&&g[2]},getRunEnv:function(){return g&&g[1]},isMicroMessenger:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},notifyApp:function(a,b){var c=navigator.userAgent;if("micromessenger"==c.toLowerCase().match(/MicroMessenger/i))return void(window.location="http://www.helijia.com/APP/down.html");c.match(/(iPhone|iPod|iPad);?/i)?window.location=a:c.match(/android/i)&&(window.location=b);var d=+new Date;setTimeout(function(){!window.document.webkitHidden&&setTimeout(function(){+new Date-d<2e3&&(window.location="http://www.helijia.com/APP/down.html")},500)},500)}};return o},{requires:["UFO/util/Storage","./util/ParamUtil"]}),KISSY.add("APP/action/Action",function(a,b,c,d){var e=a,f=b("APP/app");return{query:function(b,c,d,e){console.log("query == ",b);var g=a.Defer();return b.indexOf("/exchange.json")>=0?KISSY.use("APP/data/exchange",function(a,b){d(b),g.resolve(b)}):b.indexOf("/products.json")>=0||b.indexOf("/get_artisan_products_six.json")>=0?KISSY.use("APP/data/products_list",function(a,e){var f=e(b,c);d(f),g.resolve(f)}):b.indexOf("/get_product_tags.json")>=0?KISSY.use("APP/data/products_tags",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/product_detail.json")>=0?KISSY.use("APP/data/product",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/artisan_customer_date_list.json")>=0?KISSY.use("APP/data/artisan_available_time",function(a,b){d(b),g.resolve(b)}):b.indexOf("/artisan_common_list.json")>=0?KISSY.use("APP/data/comments_list",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/artisans.json")>=0?KISSY.use("APP/data/artisans_list",function(a,b){d(b),g.resolve(b)}):b.indexOf("/get_product_label_list.json")>=0?KISSY.use("APP/data/products_label_list",function(a,b){d(b),g.resolve(b)}):b.indexOf("/verify_mobile.json")>=0?KISSY.use("APP/data/verify_mobile",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/orders.json")>=0?KISSY.use("APP/data/orders_list",function(a,b){d(b),g.resolve(b)}):b.indexOf("/order_detail.json")>=0?KISSY.use("APP/data/order",function(a,b){d(b),g.resolve(b)}):b.indexOf("/cancel_reason.json")>=0?KISSY.use("APP/data/order_cancel_reason",function(a,b){d(b),g.resolve(b)}):b.indexOf("/artisan_detail.json")>=0?KISSY.use("APP/data/artisan",function(a,b){d(b),g.resolve(b)}):b.indexOf("/v2/store_detail")>=0?KISSY.use("APP/data/shop",function(a,b){d(b),g.resolve(b)}):console.error("XMLHttpRequest error: ",f.config.baseUrl+b+"?"+a.param(c)),g.promise},ajax2:function(b){a.mix(b,{dataType:"json",headers:{"X-Requested-With":!1}},!1);var c=f.getSessionUser();return c&&(b.data=a.mix({user_id:c.user_id,token:c.token},b.data)),b.data=a.mix({version:f.config.version},b.data),e.io(b)},ajax:function(a){return a.url=f.config.baseUrl+a.url,this.ajax2(a)},post:function(a,b,c,d){return this.ajax({type:"post",url:a,data:b,success:c,error:function(a){d&&d(a),alert("网络错误"),console.error(a)}})},update:function(a,b,c,d){return this.post(a,b,c,d)},uploadImage2:function(a){var b=new XMLHttpRequest;a.updateProgress&&b.addEventListener("progress",a.updateProgress,!1),a.success&&b.addEventListener("load",a.success,!1),a.error&&b.addEventListener("error",a.error,!1),a.transferCanceled&&b.addEventListener("abort",a.transferCanceled,!1);var c=new FormData;c.append("uploadImage",a.file),b.open("post",f.config.baseUrl+"/v2/upload_image",!0),b.send(c)},postFormData:function(b,c,d,g){var h;a.isString(b)?h={}:(h=b,b=h.url,c=h.data,d=h.success,g=h.error);var i=f.getSessionUser();i&&a.mix(c,{user_id:i.user_id,token:i.token},!1);var j=new FormData;for(var k in c)j.append(k,c[k]);return a.mix(h,{type:"post",url:f.config.baseUrl+b,data:j,dataType:"json",headers:{"X-Requested-With":!1},cache:!1,contentType:!1,processData:!1,success:d,error:g}),e.io(h)}}}),KISSY.add("APP/action/LoginAction",function(a,b,c,d){return{getVerifyCode:function(a,b,c){alert("您的验证码是：123456")},login:function(c,e,f){return b.query("/v2/verify_mobile.json",c,function(b){if(b.ret){var g=d.getSessionUser();if(g?a.mix(g,b.data):g=b.data,g.user_address)for(var h=0,i=g.user_address.length;i>h;h++)g.user_address[h].city=d.getCity(g.user_address[h].city);g.mobile=c.mobile,d.setSessionUser(g),e&&e(g)}else alert("登录失败"),f&&f()})}}},{requires:["./Action","UFO/util/Storage","../app"]}),KISSY.add("APP/login/tpl/login-tpl",function(){return'<div class="main login background">\n	<header class="bar-love header bar">\n		<button class="button button-clear button-back">\n			<i class="icon iconfont icon-back"></i></button>\n		<h1 class="title">快捷登录</h1>\n		<div class="buttons buttons-right">	\n		</div>\n	</header>\n	<div class="content has-header">\n		<div class="h_logininput">\n			<input type="text" name="mobile" placeholder="输入手机号" maxlength="11" class="h_loginwidth1"/>\n			<input type="text" name="verify_code" placeholder="验证码" maxlength="6" class="h_loginwidth2" />\n			<a action="get_verify_code" class="h_loginvalidate">获取验证码<i name="countdown" style="display:none;">(60)</i></a>\n		</div>\n		<div class="h_loginsub">\n			<button action="login" disabled="disabled">登录</button>\n			<p>点击"登录",即表示您同意<a href="../other/user_agreement.html">《河狸家用户协议》</a></p>\n		</div> \n	</div>\n</div>'}),KISSY.add("APP/login/mods/LoginPanel",function(a,b,c,d,e,f,g){function h(a){h.superclass.constructor.call(this,a)}return a.extend(h,d),UFO.augment(h,{alias:"loginpanel",initComponent:function(){this.el=a.one(g),h.superclass.initComponent.apply(this,arguments)},addCmpEvents:function(){h.superclass.addCmpEvents.apply(this,arguments);var b=this;this.el.delegate("tap click","[action=get_verify_code]:not([disabled])",function(c){var d=b.el.one("input[name=mobile]").val();if(!d)return alert("请输入手机号码！"),!1;if(!d.match(/^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/))return alert("手机号码输入格式有误！"),!1;var e=a.one(c.currentTarget);e.attr("disabled","disabled");var g=function(){var a=e.one("[name=countdown]");a.css("display","inline");var b=60;a.html("("+b+"s)");var c=setInterval(function(){a.html("("+--b+"s)"),0===b&&(e.removeAttr("disabled"),a.css("display","none"),clearInterval(c))},1e3)};return g(),f.getVerifyCode({mobile:d},function(){}),!1}),this.el.delegate("click","[action=login]",function(a){var c=e.getRecord(b.el.one(".h_logininput"));f.login(c,function(){b.fire("loginsuc")},function(){b.fire("loginfail")}),console.log("record",c)});var c=this.el.one("[name=verify_code]");c.on("input propertychange",function(a){var d=c.val();d&&6===d.length&&b.el.one("[action=login]").removeAttr("disabled")})}}),h},{requires:["node","xtemplate","UFO/Component","UFO/util/Form","../../action/LoginAction","../tpl/login-tpl"]});