/*! 2024-11-04 */
KISSY.add("UFO/util/Storage",function(a,b){return{setItem:function(a,b,c){var d=typeof c;"string"==d||"number"==d||"boolean"==d?a.setItem(b,c):a.setItem(b,JSON.stringify(c))},getItem:function(a,b){a=a.getItem(b);try{return JSON.parse(a)}catch(b){return a}},setLocalItem:function(a,b){this.setItem(localStorage,a,b)},getLocalItem:function(a){return this.getItem(localStorage,a)},setSessionItem:function(a,b){this.setItem(sessionStorage,a,b)},getSessionItem:function(a){return this.getItem(sessionStorage,a)}}},{requires:["node"]}),KISSY.add("APP/util/ParamUtil",function(a){return{processParam:function(b){for(var c in b){var d=b[c];a.isArray(d)&&(b[c]=d[0])}return b},packParam:function(b){return a.unparam(b.substring(b.indexOf("?")+1))}}}),KISSY.add("APP/app",function(a,b,c){var d="2.9.5",e=c.processParam(a.unparam(decodeURIComponent(location.search.slice(1)))),f=navigator.userAgent.toLowerCase(),g=f.match(/(hlj-\w+)\/(\d\.\d\.\d)/i),h="hlj_customer_position",i="hlj_user",j=void 0,k=void 0,l=[{name:"北京市",code:"110100"},{name:"上海市",code:"310100"},{name:"杭州市",code:"330100"},{name:"成都市",code:"510100"},{name:"深圳市",code:"440300"},{name:"广州市",code:"440100"},{name:"武汉市",code:"420100"},{name:"南京市",code:"320100"},{name:"天津市",code:"120100"},{name:"重庆市",code:"500100"}],m={apiHost:"//app.helijia.com",baseUrl:"//app.helijia.com/zmw"},n={imgBaseUrl:"../",version:d};a.mix(n,m);var o={config:n,getCookie:function(a){var b;return document.cookie.length>0&&(b=document.cookie.indexOf(a+"="),-1!=b)?(b=b+a.length+1,c_end=document.cookie.indexOf(";",b),-1==c_end&&(c_end=document.cookie.length),unescape(document.cookie.substring(b,c_end))):""},getCity:function(a){return this.getCityMap()[a]||this.getCityMap()[110100]},getCityByName:function(a){return/市$/.test(a)||(a+="市"),this.getNameKeyCityMap()[a]||this.getNameKeyCityMap()["北京市"]},getCityMap:function(){if(!j){j={};for(var a,b=0,c=l.length;c>b;b++)a=l[b],j[a.code]=a}return j},getNameKeyCityMap:function(){if(!k){k={};for(var a,b=0,c=l.length;c>b;b++)a=l[b],k[a.name]=a}return k},getCityList:function(a){return a&&a(result),l},setPosition:function(a){console.log("setPosition",a),a.city_code||(a.city_code=this.getCityByName(a.city).code),b.setSessionItem(h,a)},getPosition:function(){b.getSessionItem(h)},setSessionUser:function(a){b.setSessionItem(i,a)},getSessionUser:function(){return b.getSessionItem(i)},isLogined:function(){return!!this.getSessionUser()},getParam:function(){return e},isApp:function(){return g&&("hlj-ios"==g[1]||"hlj-android"==g[1])},isAdroidApp:function(){return g&&"hlj-android"==g[1]},isIosApp:function(){return g&&"hlj-ios"==g[1]},getAppVersion:function(){return g&&g[2]},getRunEnv:function(){return g&&g[1]},isMicroMessenger:function(){return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)},notifyApp:function(a,b){var c=navigator.userAgent;if("micromessenger"==c.toLowerCase().match(/MicroMessenger/i))return void(window.location="http://www.helijia.com/APP/down.html");c.match(/(iPhone|iPod|iPad);?/i)?window.location=a:c.match(/android/i)&&(window.location=b);var d=+new Date;setTimeout(function(){!window.document.webkitHidden&&setTimeout(function(){+new Date-d<2e3&&(window.location="http://www.helijia.com/APP/down.html")},500)},500)}};return o},{requires:["UFO/util/Storage","./util/ParamUtil"]}),KISSY.add("APP/action/Action",function(a,b,c,d){var e=a,f=b("APP/app");return{query:function(b,c,d,e){console.log("query == ",b);var g=a.Defer();return b.indexOf("/exchange.json")>=0?KISSY.use("APP/data/exchange",function(a,b){d(b),g.resolve(b)}):b.indexOf("/products.json")>=0||b.indexOf("/get_artisan_products_six.json")>=0?KISSY.use("APP/data/products_list",function(a,e){var f=e(b,c);d(f),g.resolve(f)}):b.indexOf("/get_product_tags.json")>=0?KISSY.use("APP/data/products_tags",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/product_detail.json")>=0?KISSY.use("APP/data/product",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/artisan_customer_date_list.json")>=0?KISSY.use("APP/data/artisan_available_time",function(a,b){d(b),g.resolve(b)}):b.indexOf("/artisan_common_list.json")>=0?KISSY.use("APP/data/comments_list",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/artisans.json")>=0?KISSY.use("APP/data/artisans_list",function(a,b){d(b),g.resolve(b)}):b.indexOf("/get_product_label_list.json")>=0?KISSY.use("APP/data/products_label_list",function(a,b){d(b),g.resolve(b)}):b.indexOf("/verify_mobile.json")>=0?KISSY.use("APP/data/verify_mobile",function(a,b){var e=b(c);d(e),g.resolve(e)}):b.indexOf("/orders.json")>=0?KISSY.use("APP/data/orders_list",function(a,b){d(b),g.resolve(b)}):b.indexOf("/order_detail.json")>=0?KISSY.use("APP/data/order",function(a,b){d(b),g.resolve(b)}):b.indexOf("/cancel_reason.json")>=0?KISSY.use("APP/data/order_cancel_reason",function(a,b){d(b),g.resolve(b)}):b.indexOf("/artisan_detail.json")>=0?KISSY.use("APP/data/artisan",function(a,b){d(b),g.resolve(b)}):b.indexOf("/v2/store_detail")>=0?KISSY.use("APP/data/shop",function(a,b){d(b),g.resolve(b)}):console.error("XMLHttpRequest error: ",f.config.baseUrl+b+"?"+a.param(c)),g.promise},ajax2:function(b){a.mix(b,{dataType:"json",headers:{"X-Requested-With":!1}},!1);var c=f.getSessionUser();return c&&(b.data=a.mix({user_id:c.user_id,token:c.token},b.data)),b.data=a.mix({version:f.config.version},b.data),e.io(b)},ajax:function(a){return a.url=f.config.baseUrl+a.url,this.ajax2(a)},post:function(a,b,c,d){return this.ajax({type:"post",url:a,data:b,success:c,error:function(a){d&&d(a),alert("网络错误"),console.error(a)}})},update:function(a,b,c,d){return this.post(a,b,c,d)},uploadImage2:function(a){var b=new XMLHttpRequest;a.updateProgress&&b.addEventListener("progress",a.updateProgress,!1),a.success&&b.addEventListener("load",a.success,!1),a.error&&b.addEventListener("error",a.error,!1),a.transferCanceled&&b.addEventListener("abort",a.transferCanceled,!1);var c=new FormData;c.append("uploadImage",a.file),b.open("post",f.config.baseUrl+"/v2/upload_image",!0),b.send(c)},postFormData:function(b,c,d,g){var h;a.isString(b)?h={}:(h=b,b=h.url,c=h.data,d=h.success,g=h.error);var i=f.getSessionUser();i&&a.mix(c,{user_id:i.user_id,token:i.token},!1);var j=new FormData;for(var k in c)j.append(k,c[k]);return a.mix(h,{type:"post",url:f.config.baseUrl+b,data:j,dataType:"json",headers:{"X-Requested-With":!1},cache:!1,contentType:!1,processData:!1,success:d,error:g}),e.io(h)}}}),KISSY.add("UFO/EventSupport",function(a){function b(a,b){for(var c=0,d=b.length;d>c;c++){for(var e=b[c],f=0,g=0;f<a.length;f++)a[f]!=e&&(a[g++]=a[f]);a.length=g}}function c(a){this.listeners=this.listeners||{},this.oneTimeListeners=this.oneTimeListeners||{}}return UFO.augment(c,{on:function(b,c){var d=this.listeners[b]||[];return(d=a.isArray(d)?d:[d]).push(c),this.listeners[b]=d,this},off:function(a,c){return this.listeners[a]&&b(this.listeners[a],c),this.oneTimeListeners[a]&&b(this.oneTimeListeners[a],c),this},one:function(a,b){return this.oneTimeListeners[a]=this.oneTimeListeners[a]||[],this.oneTimeListeners[a].push(b),this},fire:function(){var b=[],c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=this.listeners[c],f=this.oneTimeListeners[c];if(e)for(var g=0,h=(e=a.isArray(e)?e:[e]).length;h>g;g++)b.push(e[g].apply(this,d));if(f)for(g=0,h=(f=a.isArray(f)?f:[f]).length;h>g;g++)b.push(f[g].apply(this,d));return f=[],1==b.length?b[0]:b},fireEvent:function(){return this.fire.apply(this,arguments)},hasListener:function(a){return this.listeners[a]},relayEvents:function(a,b,c){for(var d,e=b.length,f=0;e>f;f++)d=b[f],a.on(d,this.createRelayer(c?c+d:d))},createRelayer:function(a,b){var c=this;return function(){return c.fireEvent.apply(c,[a].concat(Array.prototype.slice.apply(arguments,b||[0])))}}}),c}),KISSY.add("UFO/ComponentQuery",function(a){function b(a,b){return b.method.apply(this,[a].concat(b.args))}function c(a,b){for(var c,d=[],e=0,f=a.length,g=">"!==b;f>e;e++)(c=a[e]).getRefItems&&(d=d.concat(c.getRefItems(g)));return d}function d(a,b,c){if("*"===b)return a.slice();for(var d,e=[],f=0,g=a.length;g>f;f++)(d=a[f])&&d.isType&&d.isType(b,c)&&e.push(d);return e}function e(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)(c=a[e]).hasCls(b)&&d.push(c);return d}function f(a,b){for(var c,d=[],e=0,f=a.length;f>e;e++)(c=a[e]).getId()===b&&d.push(c);return d}var g=this,h=/^(\s?([>\^])\s?|\s|$)/,i=/^(#)?([\w\-]+|\*)(?:\((true|false)\))?/,j=[{re:/^\.([\w\-]+)(?:\((true|false)\))?/,method:d},{re:/^(?:[\[](?:@)?([\w\-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]])/,method:function(a,b,c,d){for(var e,f=[],g=0,h=a.length;h>g;g++)e=a[g],(d?String(e[b])===d:e[b])&&f.push(e);return f}},{re:/^#([\w\-]+)/,method:f},{re:/^\:([\w\-]+)(?:\(((?:\{[^\}]+\})|(?:(?!\{)[^\s>\/]*?(?!\})))\))?/,method:function(a,b,c){return g.pseudos[b](a,c)}}],k=(g.Query=function(a){a=a||{},UFO.apply(this,a)},UFO.augment(g.Query,{execute:function(d){var e,f,g=this.operations,h=0,i=g.length;for(a.isArray(d)&&(f=d);i>h;h++)if(f="^"===(e=g[h]).mode?function(a){for(var b,c=[],d=0,e=a.length;e>d;d++)for(b=a[d];b=b.ownerCt||b.floatParent;)c.push(b);return c}(f||[d]):e.mode?c(f||[d],e.mode):b(f||c([d]),e),h===i-1)return f;return[]},is:function(c){var d,e,f=this.operations,g=a.isArray(c)?c:[c],c=g.length,h=f[f.length-1];if((g=b(g,h)).length!==c)return!1;if(1<f.length)for(e=0,d=g.length;d>e;e++)if(-1===a.indexOf(this.execute(),g[e]))return!1;return!0}}),{cache:{},pseudos:{not:function(a,b){for(var c,d=k,e=0,f=a.length,g=[],h=-1;f>e;++e)c=a[e],d.is(c,b)||(g[++h]=c);return g},first:function(a){var b=[];return 0<a.length&&b.push(a[0]),b},last:function(a){var b=a.length,c=[];return b>0&&c.push(a[b-1]),c}},query:function(b,c){for(var d,e,f,g=b.split(","),h=g.length,i=0,j=[],k=[],l={};h>i;i++)b=a.trim(g[i]),d=this.cache[b]||(this.cache[b]=this.parse(b)),j=j.concat(d.execute(c));if(1<(e=j.length)){for(i=0;e>i;i++)f=j[i],console.log("cmp.id",f.id),l[f.id]||(k.push(f),l[f.id]=!0);j=k}return j},is:function(b,c){if(!c)return!0;for(var d=c.split(","),e=d.length,f=0;e>f;f++)if(c=a.trim(d[f]),(this.cache[c]||(this.cache[c]=this.parse(c))).is(b))return!0;return!1},parse:function(b){for(var c,k,l,m,n,o,p,q=[],r=j.length;b&&c!==b;){for((k=(c=b).match(i))&&(l=k[1],q.push("#"===l?{method:f,args:[a.trim(k[2])]}:"."===l?{method:e,args:[a.trim(k[2])]}:{method:d,args:[a.trim(k[2]),Boolean(k[3])]}),b=b.replace(k[0],""));!(m=b.match(h));)for(o=0;b&&r>o;o++){if(p=j[o],n=b.match(p.re),p.method,n){q.push({method:p.method,args:n.slice(1)}),b=b.replace(n[0],"");break}o===r-1&&console.error('Invalid ComponentQuery selector: "'+arguments[0]+'"')}m[1]&&(q.push({mode:m[2]||m[1]}),b=b.replace(m[0],""))}return new g.Query({operations:q})}});return k}),KISSY.add("UFO/Component",function(a,b,c,d){function e(b){this.config=b||{},a.mix(this,b,!0,void 0,!0),this.id=a.guid(),this.tplId&&(f=this.tpl=a.one("#"+this.tplId).html()),e.superclass.constructor.call(this,b),this.initComponent()}var f="<div></div>";return a.extend(e,c),UFO.augment(e,{alias:"component",initComponent:function(){this.el||(f=this.tpl||f,this.el=a.all(f)),this.bodyStyle=a.mix(this.bodyStyle||{},{padding:this.bodyPadding},!0),this.getBodyContainer().css(this.bodyStyle),this.style=a.mix(this.style||{},{padding:this.padding,margin:this.margin}),this.el.css(this.style),this.cls&&this.addClass(this.cls),this.bodyCls&&this.getBodyContainer().addClass(this.bodyCls),this.attributes&&this.el.attr(this.attributes),this.addCmpEvents()},setSize:function(a,b){this.el.width(a),this.el.height(b)},toEl:function(){return this.el},getEl:function(){return this.toEl()},getTargetEl:function(){},getBodyContainer:function(){return this.el},getContentTarget:function(){return this.el},render:function(b){(b="string"==typeof b?(b=a.one("#"+b))||a.one(b):b).append(this.toEl()),this.fire("afterrender",this)},onAdded:function(a,b){var c=this;c.ownerCt=a,c.fireEvent("added",c,a,b)},css:function(b,c){var d=Array.prototype.slice.call(arguments,0);return 1===d.length&&a.isString(d[0])?el.css(b):this.el.css(b,c),this},removeClass:function(a){return this.el.removeClass(a),this},addClass:function(a){return this.el.addClass(a),this},hasClass:function(a){return this.el.hasClass(a)},hasCls:function(a){return this.hasClass(a)},setDisabled:function(a){(this.disabled=a)?this.el.attr("disabled","disabled"):this.el.attr("disabled","")},show:function(){return!1!==this.fire("beforeshow")&&(this.el.show(),this.fire("show")),this},hide:function(a){var b=this;return!1!==this.fire("beforehide")&&(this.el.hide(),b.destroy&&(b.el.remove(),delete b),b.fire("hide"),a)&&a(),this},getRootContainer:function(){return this.rootContainer},getId:function(){return this.id},up:function(a){var b=this.getBubbleTarget();if(a)for(;b;b=b.getBubbleTarget())if(d.is(b,a))return b;return b},getBubbleTarget:function(){return this.ownerCt},addCmpEvents:function(){},set:function(a,b){this[a]=b},get:function(a){return this[a]},isType:function(a){return UFO.isType(this,a)}}),e},{requires:["node","./EventSupport","./ComponentQuery"]}),KISSY.add("UFO/layout/Layout",function(a){function b(a){this.initLayout()}return UFO.augment(b,{alias:"layout",initLayout:function(){this.el=[]},doLayout:function(b){if(this.clearItems(),!a.isEmptyObject(b))for(var c,d=0,e=b.length;e>d;d++)null!=(c=b[d])&&(this.el.push(c.getEl?c.getEl():c),c.fire)&&c.fire("afterrender",c)},clearItems:function(){this.el=[]},calculate:function(){},toEl:function(){return this.el}}),b}),KISSY.add("UFO/container/Container",function(a,b,c,d,e,f){function g(a){g.superclass.constructor.call(this,a)}var h="<div></div>";return a.extend(g,d),UFO.augment(g,{alias:"container",initComponent:function(){this.el||(h=this.tpl||h,this.el=a.all(h));var b=(b=this.layout)||"layout";this.setLayout(b),this.initItems(),g.superclass.initComponent.apply(this,arguments)},updateLayout:function(){this.layout.doLayout(this.items),this.getBodyContainer().html("");for(var b,c=this.layout.toEl(),d=0,e=(c=a.isArray(c)?c:[c]).length;e>d;d++)b=c[d],this.getBodyContainer().append(b)},initItems:function(){var b;this.items&&(b=this.items,a.isArray(b)||(b=[b]),this.items=[],this.add(b))},add:function(b,c){a.isArray(b)||(b=[b]);var d=this;if(d.items=d.items||[],!a.isEmptyObject(b))for(var e,f=0,g=b.length;g>f;f++)e=b[f],e=UFO.createItem(e,d.defaults),d.items.push(e),e&&e.onAdded&&e.onAdded(d,f),d.fireEvent("add",d,e,f);return a.isEmptyObject(this.items)||this.updateLayout(),d.items},setLayout:function(a){this.layout=UFO.create(a)},getRefItems:function(a){for(var b,c=this,d=c.items,e=d.length,f=0,g=[];e>f;f++)b=d[f],g.push(b),a&&b&&b.getRefItems&&g.push.apply(g,b.getRefItems(!0));return c.floatingItems&&g.push.apply(g,c.floatingItems),g},query:function(a){return f.query(a=a||"*",this)},down:function(a){return this.query(a)[0]||null}}),g},{requires:["node","xtemplate","../Component","../layout/Layout","../ComponentQuery"]}),KISSY.add("APP/util/MapUtil",function(a){return{getCurrentPosition:function(b,c){var d={accuracy:null,altitude:null,altitudeAccuracy:null,heading:null,latitude:"39.91092455",longitude:"116.41338370",speed:null,timestamp:null,point:{lng:116.4133837,lat:39.91092455,pf:"inner"},address:{city:"北京市",city_code:0,district:"",province:"北京市",street:"",street_number:""}},e=a.Defer();return b&&b(d),e.resolve(d),e.promise}}}),KISSY.add("APP/list/tpl/showlist-frame-tpl",function(){return' <div class="main">\n    <header class="bar-love header bar">\n	   	<a class="button button-clear back-button icon iconfont icon-back" href="javascript:history.go(-1);"> </a>\n	   	<h1 class="title">\n	   		{{title}}\n	   	</h1>\n    </header>\n	<div class="content has-header {{^if hasFooter===false}}has-footer{{/if}}">\n	</div>\n	{{^if hasFooter===false}}\n  <footer class="footer">\n   	<div class="item item-icon-left item-icon-right location-item">\n   		<a name="refresh_location" class="icon iconfont icon-refresh"></a>\n			<a name="set_location" class="button-set-location" style=""></a>\n			<span name="address" class="ellipsis" style="padding-left: 5px;">请设置服务地址</span>\n    	<i class="icon iconfont icon-forward"></i>\n   	</div>\n  </footer>\n  {{/if}}\n </div>'}),KISSY.add("UFO/modal/Modal",function(a,b,c,d){function e(a){e.superclass.constructor.call(this,a)}var f=document.body,g=['<div class="modal-backdrop">','	<div class="modal-backdrop-bg"></div>','	<div class="modal"></div>',"</div>"].join("");return a.extend(e,d),UFO.augment(e,{alias:"modal",initComponent:function(){this.el=a.one(g),this.modal=this.el.one(".modal"),this.animation=this.animation||"slide-in-left",this.modal.addClass(this.animation),this.createModal&&(this.items=this.createModal()),e.superclass.initComponent.apply(this,arguments)},getModal:function(){return this.modal},getBodyContainer:function(){return this.modal},show:function(b){var c=this;return this.appended||(a.one(document.body).append(this.toEl()),this.appended=!0),e.superclass.show.apply(this,arguments),"none"!=this.animation&&(setTimeout(function(){c.modal.removeClass("ng-leave"),c.modal.addClass("ng-enter ng-enter-active")},0),setTimeout(function(){b&&b()},400)),this},hide:function(a){function b(){e.superclass.hide.call(c,a)}var c=this;"none"!=this.animation?(this.modal.addClass("ng-leave"),this.modal.removeClass("ng-enter ng-enter-active"),setTimeout(function(){b()},400)):b()},slideIn:function(a){this.show()},slideOut:function(a){this.hide()},addCmpEvents:function(){e.superclass.addCmpEvents.apply(this,arguments);var b=this;this.on("hide",function(){a.one(f).removeClass("modal-open"),a.one(document).one("html").removeClass("modal-open"),f.scrollTop=b.origScrollTop}),this.on("beforeshow",function(){b.origScrollTop=f.scrollTop,a.one(f).addClass("modal-open"),a.one(document).one("html").addClass("modal-open")}),this.el.delegate("click tap",".button-back, .button-close",function(a){return b.hide(),!1})}}),e},{requires:["anim","node","../container/Container"]}),KISSY.add("UFO/scroll/ScrollView",function(a,b,c,d,e){function f(a){this.scrollTop=0,f.superclass.constructor.call(this,a)}var g=['<div class="scroll-content">','    <div class="scroll"></div>','    <div class="scroll-bar scroll-bar-v">','		<div class="scroll-bar-indicator scroll-bar-fade-out" style=""></div>',"	</div>","</div>"].join(""),h=document;return a.extend(f,e),UFO.augment(f,{alias:"scrollview",initComponent:function(){this.el=a.all(g),this.scrollContent=this.el,this.scroll=this.el.one(".scroll"),this.scrollBar=this.el.one(".scroll-bar"),this.scrollIndicator=this.el.one(".scroll-bar-indicator"),this.scrollIndicatorMinSize=50,f.superclass.initComponent.apply(this,arguments)},setScrollIndicatorSizeAndPos:function(){this.scrollIndicatorSize=this.clacScrollIndicatorSize(),this.setScrollIndicatorSize(),this.setScrollIndicatorPosition()},clacScrollIndicatorSize:function(){return parseInt(this.scrollContent.height()/this.scrollContent.getDOMNode().scrollHeight*this.scrollBar.height())},updateLayout:function(){f.superclass.updateLayout.apply(this,arguments),this.setScrollIndicatorSizeAndPos()},setScrollIndicatorSize:function(){this.scrollIndicatorSize>this.scrollIndicatorMinSize?this.scrollIndicatorSize<this.scrollBar.height()?this.scrollIndicator.css({height:this.scrollIndicatorSize+"px",display:"inline-block"}):this.scrollIndicator.hide():(this.scrollIndicatorSize=this.scrollIndicatorMinSize,this.scrollIndicator.css({height:this.scrollIndicatorSize+"px",display:"inline-block"}))},setScrollIndicatorPosition:function(){var a;"none"!=this.scrollIndicator.css("display")&&(a=this.scrollTop/(this.scrollContent.getDOMNode().scrollHeight-this.scrollContent.height())*(this.scrollBar.height()-this.scrollIndicatorSize),this.scrollIndicator.css({"-webkit-transform":"translate3d(0px, "+a+"px, 0px)","-ms-transform":"translate3d(0px, "+a+"px, 0px)","-moz-transform":"translate3d(0px, "+a+"px, 0px)","-o-transform":"translate3d(0px, "+a+"px, 0px)",transform:"translate3d(0px, "+a+"px, 0px)"}))},getBodyContainer:function(){return this.scroll},onScrollContentMouseMove:function(){},scrollBy:function(a){this.setScrollTop(this.calcScrollTop(a))},setScrollTop:function(a){this.scroll.css({"-webkit-transform":"translate3d(0px, "+-a+"px, 0px)","-ms-transform":"translate3d(0px, "+-a+"px, 0px)","-moz-transform":"translate3d(0px, "+-a+"px, 0px)","-o-transform":"translate3d(0px, "+-a+"px, 0px)",transform:"translate3d(0px, "+-a+"px, 0px)"}),this.fire("scroll")},calcScrollTop:function(a){var b=this;return b.scrollTop+=a,b.scrollTop<0&&(b.scrollTop=0),b.scrollTop>b.scrollContent.getDOMNode().scrollHeight-b.scrollContent.height()&&(b.scrollTop=b.scrollContent.getDOMNode().scrollHeight-b.scrollContent.height()),b.scrollTop},addCmpEvents:function(){var a=this;this.on("scroll",function(b){a.setScrollIndicatorPosition()}),this.scrollContent.on("touchstart",function(b){function c(b){a.fire("move");var c=b.touches[0].clientY;return a.scrollBy(e-c),e=c,30<(c=b.timeStamp||Date.now())-f&&(f=c,g=e),!(h=!0)}function d(b){var e,i,j,k,l=b.changedTouches[0].clientY,b=b.timeStamp||Date.now();h=!1,k=.004*(j=0<(e=(g-l)/((i=b)-f))?-1:1),function m(){var b,c;h||(b=Date.now()-i,0<j*(c=e+b*k)?a.fire("moveend"):(a.scrollBy((e+c)/2*b),setTimeout(m,10)))}(),a.scrollContent.detach("touchmove",c),a.scrollContent.detach("touchend",d)}a.fire("movestart"),a.scrollIndicator.removeClass("scroll-bar-fade-out");var e=b.touches[0].clientY,f=b.timeStamp||Date.now(),g=e,h=!1;a.scrollContent.on("touchmove",c),a.scrollContent.on("touchend",d)}),this.scrollContent.on("mousedown",function(b){a.fire("movestart"),a.scrollIndicator.removeClass("scroll-bar-fade-out");var d=b.clientY;c.on(h,"mousemove",function(b){a.fire("move"),b=b.clientY,a.scrollBy(2*(d-b)),d=b}),c.on(h,"mouseup",function(b){a.fire("moveend"),a.scrollIndicator.addClass("scroll-bar-fade-out"),c.detach(h,"mousemove")})}),this.scrollContent.on("mousewheel",function(b){var c,b=b.originalEvent;b.wheelDelta?c=b.wheelDelta/120:b.detail&&(c=-b.detail/3),a.scrollBy(c>0?-80:80)}),this.scroll.on("resize",function(a){console.log("resize====")})}}),f},{requires:["node","event","xtemplate","../container/Container"]}),KISSY.add("APP/widget/serviceaddr/tpl/search-addr-tpl",function(){return' <div class="searchAddrList border-box" style="width:100%; height:100%;">\n    <header class="header bar-love bar">\n	   	<a class="button button-clear back-button icon iconfont icon-back" href="javascript:;"> </a>\n	   	<h1 class="title">\n	   		 服务地址\n	   	</h1>\n    </header>\n    <div class="content has-header">\n    	<label class="item item-input">\n			<i class="icon icon-location placeholder-icon"></i>\n			<input type="text" name="addr_search_input_text" placeholder="输入小区名或大厦名">\n		</label>\n		<!--  \n    	<div class="item item-icon-left addr-search-input-text-wrap padding-top-bottom-8" href="#">\n	      <i class="icon iconfont icon-location" ></i>\n	   	  <input type="text" class="no-border addr-search-input-text" placeholder="输入小区名或大厦名"/>\n	    </div>\n	    -->\n        <div class="scroll-content list" style="height: calc(100% - 94px)">\n        </div>\n    </div>\n</div> '}),KISSY.add("APP/widget/serviceaddr/tpl/search-addr-item-tpl",function(){return'<a class="item item-icon-left padding-top-bottom-8" href="javascript:;" data-index="{{index}}">\n	<h2 class="name">{{title}}</h2>\n	<span class="info">{{address}}</span>\n</a>'}),KISSY.add("APP/widget/serviceaddr/SearchAddrModal",function(a,b,c,d,e,f,g){function h(b){b=a.mix(b||{},{bodyStyle:{"background-color":"#f5f5f5"}}),h.superclass.constructor.call(this,b)}var i,j=new c(g);return a.extend(h,d),a.augment(h,{initComponent:function(){var b=this,c=new BMap.Map,d={onSearchComplete:function(c){if(i.getStatus()==BMAP_STATUS_SUCCESS){var d;b.results=c,b.scrollContent.html("");for(var e=0;e<c.getCurrentNumPois();e++){d=c.getPoi(e);var f=a.one(j.render({title:d.title,address:d.address,index:e}));b.scrollContent.append(f)}}}};i=new BMap.LocalSearch(c,d),h.superclass.initComponent.apply(this,arguments),this.scrollContent=this.el.one(".scroll-content"),this.searchTextField=this.el.one("input[name=addr_search_input_text]")},createModal:function(){return f},clear:function(){this.searchTextField.val(""),this.scrollContent.html("")},show:function(){this.clear(),h.superclass.show.apply(this,arguments)},addCmpEvents:function(){h.superclass.addCmpEvents.apply(this,arguments);var b=this,c=function(a){if(""!=a){var c=(b.city?b.city+" ":"")+a;i.search(c)}};this.el.delegate("click",".back-button",function(a){b.slideOut()}),this.el.delegate("input propertychange","input[name=addr_search_input_text]",a.buffer(function(b){var d=b.currentTarget,e=a.trim(d.value);c(e)},1e3)),this.el.delegate("keyup","input[name=addr_search_input_text]",function(b){if(13===b.keyCode){var d=b.currentTarget,e=a.trim(d.value);c(e)}}),this.el.delegate("click",".list .item",function(c){var d=c.currentTarget,e=a.one(d).attr("data-index");b.fire("itemselected",b.results.getPoi(e)),b.slideOut()})}}),h},{requires:["node","xtemplate","UFO/modal/Modal","UFO/scroll/ScrollView","./tpl/search-addr-tpl","./tpl/search-addr-item-tpl"]}),KISSY.add("APP/widget/serviceaddr/tpl/service-addr-tpl",function(){return'<div class="serviceAddr border-box" style="">\n	<header class="header bar-love bar">\n		<a class="button button-clear back-button icon iconfont icon-back"\n			href="javascript:;"> </a>\n		<h1 class="title">服务地址</h1>\n		<div class="buttons buttons-right">\n			<!-- <button class="button button-clear icon ion-email-unread"></button> -->\n			<button class="button button-clear icon iconfont" name="ok" style="">\n				确定</button>\n		</div>\n	</header>\n\n	<div class="content has-header service-position-content">\n		<div class="list">\n			<div class="item item-divider  no-border"></div>\n			<a\n				class="item item-icon-left item-icon-right no-border general-address"\n				href="javascript:;" style="height: 48px;"> <i\n				class="icon iconfont icon-location" style="font-size: 20px;"></i> <span\n				name="address">选择服务地址</span> <i class="icon iconfont icon-forward"></i>\n			</a>\n			<div class="item item-divider  no-border">\n				详细地址<span style="color: #686763;">(选项，如门牌号)</span>\n			</div>\n			<label class="item item-input">\n		    <input type="text" name="addrDetail">\n		  </label>\n		</div>\n		<div\n			style="padding-top: 20px; padding-left: 10px; padding-right: 10px;">\n			<button name="ok" class="button button-full button-lightred"\n				style="border-radius: 6px; letter-spacing: 30px;">确定</button>\n		</div>\n	</div>\n</div>'}),KISSY.add("APP/widget/serviceaddr/ServiceAddrModal",function(a,b,c,d,e){function f(b){b=a.mix(b||{},{bodyStyle:{"background-color":"#f5f5f5"}}),f.superclass.constructor.call(this,b)}return a.extend(f,c),a.augment(f,{initComponent:function(){f.superclass.initComponent.apply(this,arguments)},createModal:function(){return e},setPosition:function(a){this.position=a,this.city=a.city,a&&a.address&&this.el.one(".serviceAddr span[name=address]").html(a.address.concat(a.title||""))},onAddrItemSelected:function(a){this.setPosition(a)},addCmpEvents:function(){f.superclass.addCmpEvents.apply(this,arguments);var b=this;this.el.delegate("click",".back-button",function(a){b.fire("clickBackButton")!==!1&&b.slideOut()}),this.el.delegate("click",".general-address",function(c){b.searchAddrModal?b.searchAddrModal.slideIn():(b.searchAddrModal=new d,b.city&&b.searchAddrModal.set("city",b.get("city")),b.searchAddrModal.on("itemselected",a.bind(b.onAddrItemSelected,b)),b.searchAddrModal.slideIn())}),this.el.delegate("click","button[name=ok]",function(c){var d=a.one("input[name=addrDetail]").val();if(b.position&&(b.position.addrDetail=d),b.allowBlank!==!1||b.position){var e=a.mix({},b.position,!0,["addrDetail","address","city","point","postcode","province","title"],!0);b.fire("ok",e)!==!1&&b.slideOut()}else alert("请选择服务地址!")})}}),f},{requires:["node","UFO/modal/Modal","./SearchAddrModal","./tpl/service-addr-tpl"]}),KISSY.add("APP/list/mods/ShowListFrame",function(a,b,c,d,e,f,g,h,i,j){function k(){k.superclass.constructor.apply(this,arguments)}return KISSY.extend(k,e),KISSY.augment(k,{initComponent:function(){this.el=a.all(new d(i).render({title:this.title||"",hasFooter:this.config.hasFooter})),console.log("this.el",this.el),this.scrollView=this.el.getDOMNode(),this.header=this.el.one(".header"),this.footer=this.el.one(".footer"),this.items=this.createContent(),this.createHeader&&this.setHeader(this.createHeader()),k.superclass.initComponent.apply(this,arguments)},setTitle:function(b){this.header.one(".title").html(b),a.one("head title").html(b)},setHeader:function(a){this.header.html(""),this.header.append(a)},getBodyContainer:function(){return this.el.one(".content")},addScrollListener:function(){this.scrollView.addEventListener("scroll",this.scrollHandler)},removeScrollListener:function(){this.scrollView.removeEventListener("scroll",this.scrollHandler)},locationBusinessDistrict:function(b,c){var d=this,e=a.Defer();return f.getCurrentPosition().then(function(a){return d.city||d.setCity(h.getCityByName(a.address.city)),a.address.city==d.city.name?d.getBusinessDistrict(a):!1}).then(function(a){console.log("locationBusinessDistrict arguments==",a),b&&b(a),e.resolve(a)},function(a){c&&c(a),e.reject(a)}),e.promise},getBusinessDistrict:function(b,c,d){var e=a.Defer(),f=this;return b?(b.address&&!a.isString(b.address)&&(b.city=b.address.city,b.address=b.address.city.concat(b.address.street).concat(b.address.street_number)),b.point?g.query("/resources/data/exchange.json",{city:f.city.code,longitude:1e8*b.point.lng,latitude:1e8*b.point.lat},function(a){var d=a.data;d&&d.length>0?f.setPosition(b):f.setFooterText("选择的位置超出服务范围，请重新选择"),c&&c(d),e.resolve(d)},function(a){console.error("error",a),f.setFooterText("设置服务地址失败"),d&&d(a),e.reject(a)}):(c&&c(),e.resolve()),e.promise):(c&&c(),e.resolve(),e.promise)},setFooterText:function(a){this.el.one(".footer [name=address]").html(a)},setCity:function(a){this.city=a},setPosition:function(a){this.position=a,a&&this.setFooterText(a.address.concat(a.title?a.title:"").concat(a.addrDetail?a.addrDetail:"")),h.setPosition(a)},addCmpEvents:function(){var b=this;this.el.delegate("click","a[name=set_location]:not([disabled])",function(c){var d=a.one(c.currentTarget);d.attr("disabled","disabled"),b.serviceAddrModal?b.serviceAddrModal.show():(b.serviceAddrModal=new j({allowBlank:!1}),b.serviceAddrModal.on("hide",function(){b.addScrollListener&&b.addScrollListener(),d.removeAttr("disabled")}),b.serviceAddrModal.on("beforeshow",function(){b.removeScrollListener&&b.removeScrollListener()}),b.serviceAddrModal.on("ok",function(a){b.getBusinessDistrict(a).done(function(a){b.fire("changeDistrict",a)})}),b.position?b.serviceAddrModal.setPosition(b.position):b.serviceAddrModal.set("city",b.city.name),b.serviceAddrModal.show())}),this.el.delegate("click","a[name=refresh_location]",function(a){b.locationBusinessDistrict().then(function(a){b.fire("changeDistrict",a)})}),b.el.delegate("click",".back-button",function(){b.fire("clickbackbutton")})}}),k},{requires:["node","event","xtemplate","UFO/container/Container","APP/util/MapUtil","APP/action/Action","APP/app","../tpl/showlist-frame-tpl","APP/widget/serviceaddr/ServiceAddrModal"]}),KISSY.add("UFO/mask/Mask",function(a,b,c){function d(a){d.superclass.constructor.call(this,a)}var e=['<div class="mask-container visible">','	<div class="masker">',"	</div>","</div>"].join(""),f=document.body,g=a.one(f);return a.extend(d,c),UFO.augment(d,{alias:"mask",initComponent:function(){this.el=a.one(e),this.backdrop=a.one('<div class="backdrop visible backdrop-loading active" style="position:absolute;"></div>'),this.maskTarget=this.maskTarget||g,this.setMaskBody(this.createMaskBody()),this.text&&this.setText(this.text),d.superclass.initComponent.apply(this,arguments)},setMaskBody:function(a){this.el.one(".masker").html(""),this.el.one(".masker").append(a)},setText:function(a){this.text=a,this.el.one(".masker span").html(a)},createMaskBody:function(){return"<span></span>"},show:function(){!1!==this.fire("beforeshow")&&(this.maskTarget.append(this.backdrop),this.maskTarget.append(this.el),this.el.addClass("active"));
},hide:function(a){var b=this;!1!==this.fire("beforehide")&&(this.el.removeClass("active"),setTimeout(function(){a&&a(),b.backdrop.remove(),b.el.remove(),b.fire("hide"),delete b},200))},addCmpEvents:function(){var b=this;d.superclass.addCmpEvents.apply(this,arguments),g==this.maskTarget&&(this.on("hide",function(){g.removeClass("modal-open"),a.one(document).one("html").removeClass("modal-open"),f.scrollTop=b.origScrollTop}),this.on("beforeshow",function(){b.origScrollTop=f.scrollTop,g.addClass("modal-open"),a.one(document).one("html").addClass("modal-open")}))}}),d},{requires:["node","../Component"]}),KISSY.add("APP/util/ImageUtil",function(a,b,c,d){const e=new IntersectionObserver(function(a){a.forEach(function(a){a.isIntersecting&&(a.target.src=a.target.getAttribute("data-ks-lazyload"),e.unobserve(a.target),a.target.removeAttribute("data-ks-lazyload"))})},{threshold:0,rootMargin:"200px"});return{loadImages:function(a){a.forEach(function(a){e.observe(a)})}}}),KISSY.add("UFO/core/lang/Number",function(a){return{toSignedNumberString:function(a,b){return a>0?"+"+String(a):0==a?(b||"")+String(a):String(a)},toHex:function(a){return a.toString(16)},toAmountWords:function(a){for(var b=["","万","亿"],c=["拾","佰","仟"],d=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"],e=String(a).split("."),f=0,g=0,h=0,i="",j=0,k=1,l=e[0].length;l>=k;k++){var j=e[0].charAt(l-k),m=0;l-k-1>=0&&(m=e[0].charAt(l-k-1)),0!=(h+=Number(j))&&(i=d[Number(j)].concat(i),"0"==j)&&(h=0),l-k-1>=0&&(3!=f?(0!=m&&(i=c[f].concat(i)),f++):("万"!=i.charAt(f=0)&&"亿"!=i.charAt(0)||(i=i.substr(1,i.length-1)),i=b[g].concat(i),h=0)),3==f&&g++}return i+="元",e[1]?(0!=(j=e[1].charAt(0))&&(i+=d[Number(j)]+"角"),0!=(j=e[1].charAt(1))&&(i+=d[Number(j)]+"分")):i+="整",i}}}),KISSY.add("UFO/core/lang/Date",function(a,b){return{getMonthName:function(a,b){return(!0===b?["&#74;&#97;&#110;","&#70;&#101;&#98;","&#77;&#97;&#114;","&#65;&#112;&#114;","&#77;&#97;&#121;","&#74;&#117;&#110;","&#74;&#117;&#108;","&#65;&#117;&#103;","&#83;&#101;&#112;","&#79;&#99;&#116;","&#78;&#111;&#118;","&#68;&#101;&#99;"]:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"])[a.getMonth()]},getWeekName:function(a,b){return(!0===b?["&#83;&#117;&#110;","&#77;&#111;&#110;","&#84;&#117;&#101;","&#87;&#101;&#100;","&#84;&#104;&#117;&#114;","&#70;&#114;&#105;","&#83;&#97;&#116;"]:["Sun","Mon","Tue","Wed","Thur","Fri","Sat"])[a.getDay()]},format:function(a,c){if(!a)return"";c=c||"yyyy-MM-dd mm:ss";var d,e,f,g={TZ:b.toSignedNumberString(parseInt(-a.getTimezoneOffset()/60)),"q+":Math.floor((a.getMonth()+3)/3),"y+":a.getFullYear(),MN:this.getMonthName(a,!0),"M+":a.getMonth()+1,"d+":a.getDate(),WN:this.getWeekName(a),"h+":a.getHours(),"H+":(d=a.getHours())<13?d:d-12,"m+":a.getMinutes(),MP:a.getMinutes()-(new Date).getMinutes(),"s+":a.getSeconds(),DP:a.getHours()<12?"AM":"PM"};for(e in g)new RegExp("("+e+")").test(c)&&(f=RegExp.$1,c=c.replace(f,function(){return"yy"===f?g[e]%100:1<f.length&&"number"==typeof g[e]&&-1<g[e]&&g[e]<10?"0"+g[e]:g[e]}));return c}}},{requires:["./Number"]}),KISSY.add("APP/util/XTemplateUtil",function(a,b,c,d){return b.addCommand("getImgAbsolutePath",function(a,b){var c=b.params[0];return c?d.config.imgBaseUrl+(0===c.indexOf("/")?c.substr(1):c):"../resources/images/default_user.png"}),b.addCommand("formatPrice",function(a,b){return Number(b.params[0]).toFixed(2)}),b.addCommand("formatDateTime",function(b,d){var e=d.params[0],f="yyyy-MM-dd";return a.isNumber(e)&&(e=new Date(e)),2===d.params.length&&(f=d.params[1]),c.format(e,f)}),b.addCommand("fixedDigits",function(a,b){var c=2;return 2===b.params.length&&(c=b.params[1]),Number(b.params[0]).toFixed(c)}),b.addCommand("join",function(a,b){var c=",";return 2===b.params.length&&(c=b.params[1]),b.params[0].join(c)}),b.addCommand("getHost",function(a,b){return location.host}),b.addCommand("encodeURIComponent",function(a,b){return encodeURIComponent(b.params[0])}),{}},{requires:["xtemplate","UFO/core/lang/Date","../app"]}),KISSY.add("APP/widget/tpl/spinner-loading-small-tpl",function(){return'\n<span class="spinner spinner-ios-small loading"><svg\n		viewBox="0 0 64 64">\n		<g stroke-width="4" stroke-linecap="round">\n		<line y1="12" y2="20" transform="translate(32,32) rotate(180)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values="1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0;1"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(210)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values="0;1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(240)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".1;0;1;.85;.7;.65;.55;.45;.35;.25;.15;.1"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(270)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".15;.1;0;1;.85;.7;.65;.55;.45;.35;.25;.15"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(300)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".25;.15;.1;0;1;.85;.7;.65;.55;.45;.35;.25"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(330)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".35;.25;.15;.1;0;1;.85;.7;.65;.55;.45;.35"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(0)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".45;.35;.25;.15;.1;0;1;.85;.7;.65;.55;.45"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(30)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".55;.45;.35;.25;.15;.1;0;1;.85;.7;.65;.55"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(60)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".65;.55;.45;.35;.25;.15;.1;0;1;.85;.7;.65"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(90)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".7;.65;.55;.45;.35;.25;.15;.1;0;1;.85;.7"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(120)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values=".85;.7;.65;.55;.45;.35;.25;.15;.1;0;1;.85"\n			repeatCount="indefinite"></animate></line>\n		<line y1="12" y2="20" transform="translate(32,32) rotate(150)">\n		<animate attributeName="stroke-opacity" dur="750ms"\n			values="1;.85;.7;.65;.55;.45;.35;.25;.15;.1;0;1"\n			repeatCount="indefinite"></animate></line></g></svg></span>\n'}),KISSY.add("APP/products/tpl/product-list-tpl",function(){return'<div name="product_list"  class="list-panel">\n	{{^if hideTabNavSort}}\n	<ul class="sort-nav-tab row row-no-padding">\n		<li class="sort-tab-item col" ><a class="border-box">综合排序</a></li>\n		<li class="sort-tab-item col" data-order_by="sold_amount">\n			<a class="border-box">销量优先</a>\n		</li>\n		<li class="sort-tab-item col price-tab-item" data-order_by="price_up">\n			<a class="border-box ">价格排序<i class="sort-tag"></i></a>\n		</li>\n	</ul>\n	{{/if}}\n	<ul class="list-content">\n	</ul>\n</div>\n'}),KISSY.add("APP/products/tpl/product-list-item-tpl",function(){return'{{#each products}}\n	 \n		<li class="product-item">\n			<a class="card-item" href="javascript:;" data-id="{{product_id}}">\n				 {{#if promotion_pic}}\n				  	<label class="corner-label"><img src="{{getImgAbsolutePath promotion_pic}}" width="100%"> </label>\n				 {{/if}}\n		  		{{#if service_mode}}\n			     <label class="one2many-label"><img src="{{getImgAbsolutePath product_ext_info_multiple.apply_status_icon}}" style="width:100%;"></label>\n				{{/if}}\n				<img src="../resources/images/default_product.png" class="product-img" data-ks-lazyload="{{getImgAbsolutePath image}}" width="100%" />\n				<span class="item-info">\n					<span class="desc">{{name}}</span> \n					<span class="flex row-center detail">\n						<font class="price">￥{{price}}</font>\n						<span class="times">\n							{{#if service_mode}}\n							已报 <i style="color:f784a7;">{{product_ext_info_multiple.apply_nums}}</i>人\n							{{else}}\n							{{sold_amount}}人做过\n							{{/if}}\n						</span>\n					</span>\n				</span>\n			</a>\n		</li>\n	 \n{{/each}}\n'}),KISSY.add("APP/products/mods/ProductList",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){m.superclass.constructor.apply(this,arguments)}var n=(window,20),o=a.one(j),p=new d(l);return KISSY.extend(m,f),KISSY.augment(m,{initComponent:function(){this.el=a.one(new d(k).render({hideTabNavSort:this.hideTabNavSort})),this.productListContent=this.el.one(".list-content"),m.superclass.initComponent.apply(this,arguments)},setActiveSortTab:function(b){var c=this;a.isNumber(b)&&(b=this.el.one(".sort-nav-tab .sort-tab-item:nth-child("+(b+1)+")"));var d=b.attr("data-order_by");this.el.all(".sort-nav-tab .sort-tab-item").removeClass("active"),this.el.one(".sort-nav-tab .price-tab-item").one(".sort-tag").removeClass("desc").removeClass("asc"),b.addClass("active"),delete c.productParams.order_by,d&&(c.productParams.order_by=d,"price_up"==d?(b.attr("data-order_by","price_down"),b.one(".sort-tag").addClass("asc")):"price_down"==d&&(b.attr("data-order_by","price_up"),b.one(".sort-tag").addClass("desc"))),c.load()},setQueryUrl:function(a){this.queryUrl=a},setQueryParams:function(a){this.productParams=a},getQueryParams:function(){return this.productParams},load:function(b){var c=this,d=new g({text:"正在加载..."});c.fire("beforeload");var e=a.later(d.show,500,!1,d);this.loadFinished=!1,this.productListContent.html(""),this.productParams.offset=0,this.query(b,function(a){return c.fire("afterload"),a.ret?void(a.data&&a.data.length?(e.cancel(),d.hide()):(d.setText("没有找到相关查询!"),setTimeout(function(){d.hide()},2e3))):(d.setText("加载出错了"),void setTimeout(function(){d.hide()},2e3))},function(){d.setText("加载出错了"),setTimeout(function(){d.hide()},2e3)})},loadMore:function(a){this.productParams.offset=this.productParams.offset+n,this.query(this.productParams,a)},query:function(a,b,c){var d=this;a=this.productParams=a||this.productParams,e.query("/v2/products.json",a,function(a){b&&b(a);var c=a.data;d.productListContent.append(p.render({products:c})),c&&c.length<n&&(d.loadFinished=!0);var e=d.el.getDOMNode().querySelectorAll("ul.list-content > li:nth-last-child(-n +"+c.length+")  > a > img");h.loadImages(e)},function(a){console.error("Action.list error=",a),c&&c(a)})},appendLoadingMoreSpinner:function(){this.productListContent.append(o)},removeLoadingMoreSpinner:function(){o.remove()},addCmpEvents:function(){var b=this;this.el.delegate("click",".sort-nav-tab .sort-tab-item a",function(c){b.setActiveSortTab(a.one(c.currentTarget).parent(".sort-tab-item"))})}}),m},{requires:["node","event","xtemplate","APP/action/Action","UFO/Component","UFO/mask/Mask","APP/util/ImageUtil","APP/util/XTemplateUtil","APP/widget/tpl/spinner-loading-small-tpl","../tpl/product-list-tpl","../tpl/product-list-item-tpl"]}),KISSY.add("APP/artisans/tpl/artisan-list-tpl",function(){return'<div name="artisan_list" class="list-panel">\n	{{^if hideTabNavSort}}\n  <ul class="sort-nav-tab row row-no-padding">\n 		<li class="sort-tab-item col" ><a class="border-box">综合排序</a></li>\n 		<li class="sort-tab-item col" data-order_by="popularity"><a class="border-box">人气优先</a></li>\n 		<li class="sort-tab-item col price-tab-item" data-order_by="price_up">\n 			<a class="border-box ">均价排序<i class="sort-tag"></i></a>\n 		</li>\n 	</ul>\n	{{/if}}\n	<div class="artisan-list-content" name="artisan_list_content"> </div>\n</div>'}),KISSY.add("APP/artisans/tpl/artisan-list-item-tpl",function(){return'{{#each this}}\n<a href="javascript:;" class="item item-avatar item-artisan" data-id="{{artisan_id}}">                                                         \n     <img src="../resources/images/default_user.png" data-ks-lazyload="{{getImgAbsolutePath avatar}}">\n     <div class="info">\n     	 <span class="flex row-no-padding row-center title">\n			<h3> {{name}}</h3>\n			{{#if showDistance}}<span class="distance">{{getDistance distance}}m</span>{{/if}}\n		</span>\n	     <h2>\n	     	{{#if artisan_level>0}}<img src="../resources/images/star/{{artisan_level*0.5}}.gif" style="width:{{calStarWidth artisan_level}}px; margin-top: -4px;"> {{/if}}\n	     	{{#if artisan_glory}}<img src="../resources/images/star/glory.jpg" style="width:17px; margin-left:-6px;"> {{/if}}\n          {{artisan_level_value}}\n	     </h2>\n	     <span class="flex row-no-padding row-center detail">\n	        <h4 class="time" >接单{{service_count}}次</h4>\n	     	<h4 class="price">均价：￥{{formatPrice avg_price}}</h4>\n	     </span>\n     </div>\n</a>\n{{/each}}\n'}),KISSY.add("APP/artisans/mods/ArtisanList",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){o.superclass.constructor.apply(this,arguments)}var p=20,q=a.one(l),r=new f(n,{commands:{calStarWidth:function(a,b){return 20*Math.round(.5*b.params[0])},getDistance:function(a,b){return Math.round(1e3*b.params[0])}}});return KISSY.extend(o,h),UFO.augment(o,{alias:"artisanlist",initComponent:function(){this.el=a.one(new f(m).render({hideTabNavSort:this.hideTabNavSort})),this.queryUrl="/v2/artisans.json",this.artisanListContent=this.el.one("[name=artisan_list_content]"),o.superclass.initComponent.apply(this,arguments)},showSortNavTab:function(a){a===!1?this.el.one(".sort-nav-tab").hide():this.el.one(".sort-nav-tab").css("display","")},setActiveSortTab:function(b){var c=this;a.isNumber(b)&&(b=this.el.one(".sort-nav-tab .sort-tab-item:nth-child("+(b+1)+")"));var d=b.attr("data-order_by");this.el.all(".sort-nav-tab .sort-tab-item").removeClass("active"),this.el.one(".sort-nav-tab .price-tab-item").one(".sort-tag").removeClass("desc").removeClass("asc"),b.addClass("active"),delete c.artisanParams.order_by,d&&(c.artisanParams.order_by=d,"price_up"==d?(b.attr("data-order_by","price_down"),b.one(".sort-tag").addClass("asc")):"price_down"==d&&(b.attr("data-order_by","price_up"),b.one(".sort-tag").addClass("desc"))),c.load()},setQueryUrl:function(a){this.queryUrl=a},setQueryParams:function(a){this.artisanParams=a},getQueryParams:function(){return this.artisanParams},load:function(b){var c=this,d=new i({text:"正在加载..."});b=this.artisanParams=b||this.artisanParams,this.fire("beforeload");var e=a.later(d.show,500,!1,d);this.loadFinished=!1,this.artisanListContent.html(""),this.artisanParams.offset=0,this.artisanParams.page_size=p,this.query(b,function(a){return c.fire("afterload"),a.ret?void(a.data&&a.data.length?(e.cancel(),d.hide()):(d.setText("没有找到相关查询!"),setTimeout(function(){d.hide()},2e3))):(d.setText("加载出错了"),void setTimeout(function(){d.hide()},2e3))},function(){d.setText("加载出错了"),setTimeout(function(){d.hide()},2e3)})},loadMore:function(a){this.artisanParams.offset+=p,this.query(this.artisanParams,a)},query:function(a,b,c){var d=this;a=this.artisanParams=a||this.artisanParams,g.query(this.queryUrl,a,function(a){if(!a.ret)return alert(JSON.stringify(a)),void(c&&c(a));b&&b(a);var e=a.data;e.showDistance=d.showDistance,d.artisanListContent.append(r.render(e)),e.length<p&&(d.loadFinished=!0);var f=d.el.getDOMNode().querySelectorAll(".artisan-list-content > .item-artisan:nth-last-child(-n + "+e.length+") > img");j.loadImages(f)},function(a){console.log("msg",a),c&&c(a)})},appendLoadingMoreSpinner:function(){this.artisanListContent.append(q)},removeLoadingMoreSpinner:function(){q.remove()},addCmpEvents:function(){var b=this;this.el.delegate("click",".sort-nav-tab .sort-tab-item a",function(c){b.setActiveSortTab(a.one(e.parent(c.currentTarget,".sort-tab-item")))}),this.el.delegate("click","a.item-artisan",function(c){var d=e.attr(c.currentTarget,"data-id"),f={artisan:d};b.productHref&&(f.productHref=encodeURIComponent(b.productHref)),location.href="../artisan/index.html?"+a.param(f)+(location.search?"&"+location.search.slice(1):"")})}}),o},{requires:["node","io","event","dom","xtemplate","APP/action/Action","UFO/Component","UFO/mask/Mask","APP/util/ImageUtil","APP/util/XTemplateUtil","APP/widget/tpl/spinner-loading-small-tpl","../tpl/artisan-list-tpl","../tpl/artisan-list-item-tpl"]}),KISSY.add("APP/widget/search/tpl/search-modal-tpl",function(){return'<div class="bar bar-header item-input-inset">\n	<form action="javascript:;" class="item-input-wrapper">\n		<i class="icon iconfont icon-search placeholder-icon"></i>\n		<input type="search" placeholder="搜索手艺人">\n	</form>\n  <button name="button_cancel" class="button button-clear">\n	取消\n  </button>\n</div>\n<div class="content">\n <table class="product-label-list"  cellspacing="10">\n </table>\n</div>'}),KISSY.add("APP/widget/search/tpl/product-label-tpl",function(){return'{{#each this}}\n	{{#if xindex%3===0}}\n		  {{#if xindex>0}}\n            </tr>\n          {{/if}}\n         {{^if xindex===xcount-1}}\n		   <tr>\n         {{/if}}\n    {{/if}}\n  	<td align="center"><a data-value="{{id}}" data-label="{{tag}}" class="product-label">{{tag}}</a></td>\n{{/each}}'}),KISSY.add("APP/widget/search/SearchModal",function(a,b,c,d,e,f,g,h){function i(a){i.superclass.constructor.call(this,a)}var j=window,k=new d(h);return a.extend(i,e),a.augment(i,{initComponent:function(){i.superclass.initComponent.apply(this,arguments),this.el.one("input[type=search]").getDOMNode().focus()},showProductLabels:function(){var a=this.el.one(".product-label-list");f.query("/user/get_product_label_list.json",{},function(b){var c=b.labels;a.html(k.render(c))})},createModal:function(){return g},doSearchArtisan:function(b){var c=this,d=a.clone(c.params);d.keyword=b,j.location.href="../artisans/artisans_of_search.html?".concat(a.param(d))},doSearchProduct:function(b,c){var d=this,e=a.mix({filter_label:b,title:c},d.params);e.filter_label=b,j.location.href="../products/products_of_search.html?".concat(a.param(e))},setParams:function(a){this.params=a},setCity:function(b){a.isString(b)&&(b=app.getCity(b)),this.city=b},setPosition:function(a){this.position=a},addCmpEvents:function(){i.superclass.addCmpEvents.apply(this,arguments);var b=this;this.el.delegate("submit","form",function(c){var d=a.one(c.currentTarget).one("input[type=search]").getDOMNode(),e=a.trim(d.value);d.blur(),b.hide(),b.doSearchArtisan(e)}),this.el.delegate("tap click","button[name=button_cancel]",function(a){return b.hide(),!1}),this.el.delegate("tap click","a.product-label",function(a){var d=c.attr(a.currentTarget,"data-value"),e=c.attr(a.currentTarget,"data-label");return b.hide(),b.doSearchProduct(d,e),!1})}}),i},{requires:["node","dom","xtemplate","UFO/modal/Modal","../../action/Action","./tpl/search-modal-tpl","./tpl/product-label-tpl"]}),KISSY.add("APP/list/mods/ShowList",function(a,b,c,d,e,f,g,h,i,j){function k(b){b=b||{},a.mix(b,{productTypeName:"filter_category",artisanTypeName:"filter_type"},!1,void 0,!0),k.superclass.constructor.call(this,b)}var l=new e(['<li class="tag-item col"> ',"<a>{{name}}</a>","</li>"].join(""));return KISSY.extend(k,g),KISSY.augment(k,{initComponent:function(){var a=this;k.superclass.initComponent.apply(this,arguments),this.artisanList=new i(this.config),this.artisanList.on("beforeload",function(){a.removeScrollListener()}),this.artisanList.on("afterload",function(){a.addScrollListener()}),this.productList=new h(this.config),this.productList.on("beforeload",function(){a.removeScrollListener()}),this.productList.on("afterload",function(){a.addScrollListener()}),this.header=this.el.one(".header"),this.headerTabItems=this.header.all(".tab-item"),this.headerNavTabBodyItems=this.el.all(".header-nav-tab-body-item"),this.el.one(".product-tab-body-item").append(this.productList.toEl()),this.el.one(".artisan-tab-body-item").append(this.artisanList.toEl())},createContent:function(){return['<div class="header-nav-tab-body-item product-tab-body-item">',"</div>",'<div class="header-nav-tab-body-item artisan-tab-body-item"  style="padding:0; display:none;">',"</div>"].join("")},createHeader:function(){return['<a class="button button-clear back-button icon iconfont icon-back" href="javascript:;" onclick="history.go(-1);"> </a>','<div class="tab-nav tabs title">','   <a class="tab-item" data-index="0">作品</a>','   <a class="tab-item" data-index="1">手艺人</a>',"</div>",'<div class="buttons buttons-right" style="-webkit-transition-duration: 0ms; transition-duration: 0ms;">','	<button name="button_search" class="button button-clear icon iconfont icon-search">  </button>',"</div>"].join("")},setActiveHeaderTab:function(b){var c=this,d=0;a.isNumber(b)?(d=b,b=this.el.one(".header .tab-item:nth-child("+(d+1)+")")):d=b.attr("data-index"),d=parseInt(d),b.hasClass("active")||(this.headerTabIndex=d,c.headerTabItems.removeClass("active"),b.addClass("active"),c.headerNavTabBodyItems.hide(),a.one(c.headerNavTabBodyItems[d]).show(),b.data("inited")||(b.data("inited",!0),0==d?this.createProductTabBodyItem():this.createArtisanTabBodyItem()))},createArtisanTabBodyItem:function(){this.createArtisanTypeTabNav()},createArtisanTypeTabNav:function(){var b=this,c=b.block,f=c.search_types2;b.el.one(".artisan-tab-body-item");if(f.length>1){var g=new e(['<ul class="tab-nav-type flex">',"{{#each this}}",'<li class="tab-item-type col " data-key="'+this.artisanTypeName+'" data-value={{value}}>','<a style="background:{{background background_normal img_url}}; background-size: 30px 30px;">','<i class="arrow"></i>',"{{name}}","</a>","</li>","{{/each}}","</ul>"].join(""),{commands:{background:function(a,b){return"#"+b.params[0].toString(16)+" url("+b.params[1]+") no-repeat center 5px"}}});d.insertBefore(a.one(g.render(f)),this.artisanList.getEl()),b.setArtisanActiveTypeTab(0)}else 1==f.length?this.filterArtisanByType(f[0].value):console.error("search_types.length == 0")},setArtisanActiveTypeTab:function(b){var c=this;if(a.isNumber(b)&&(b=c.el.one(".artisan-tab-body-item .tab-nav-type .tab-item-type:nth-child("+(b+1)+")")),!b.hasClass("active")){c.el.all(".artisan-tab-body-item .tab-nav-type .tab-item-type").removeClass("active"),b.addClass("active");var d=b.attr("data-value");b.attr("data-key");this.filterArtisanByType(d)}},filterArtisanByType:function(b){var c=a.clone(this.params);this.artisanType=b,c[this.artisanTypeName]=b,this.artisanList.setQueryParams(c),this.artisanList.setActiveSortTab(0)},createProductTabBodyItem:function(){this.createProductServiceTabNav()},createProductServiceTabNav:function(){var b=this,c=b.block,f=c.search_types1;if(f.length>1){var g=new e(['<ul class="tab-nav-type flex">',"{{#each this}}",'<li class="tab-item-type col " data-key="'+this.productTypeName+'" data-value={{value}}>','<a style="background:{{background background_normal img_url}}; background-size: 30px 30px;">','<i class="arrow"></i>',"{{name}}","</a>","</li>","{{/each}}","</ul>"].join(""),{commands:{background:function(a,b){return"#"+b.params[0].toString(16)+" url("+b.params[1]+") no-repeat center 5px"}}});d.insertBefore(a.one(g.render(f)),this.productList.getEl()),b.setProductActiveTypeTab(0)}else 1==f.length?b.filterProductByType(f[0].value):console.log("createProductServiceTabNav search_types1.length == 0")},setProductActiveTypeTab:function(b){var c=this;a.isNumber(b)&&(b=c.el.one(".product-tab-body-item .tab-nav-type .tab-item-type:nth-child("+(b+1)+")")),b.hasClass("active")||(c.el.all(".product-tab-body-item .tab-nav-type .tab-item-type").removeClass("active"),b.addClass("active"),c.filterProductByType(b.attr("data-value")))},filterProductByType:function(b){this.productType=b,this.createProductTagPanel(b);var c=a.clone(this.params);c[this.productTypeName]=b,console.log("params==",c),this.productList.setQueryParams(c),this.productList.setActiveSortTab(0)},createProductTagPanel:function(b){var c=this;c.productTagPanel&&c.productTagPanel.remove(),f.query("/v2/get_product_tags.json",{city:c.city.code,category:b,referer_page:"products"},function(b){var e=b.data;if(e&&e.length){c.productTagPanel=a.one('<div class="tag-panel"></div>');var f=0;a.each(e,function(b){(f%3===0||3===b.length)&&(row=a.one('<ul class="flex tag-row"></ul>'),c.productTagPanel.append(row)),f+=b.length;var d=a.one(l.render({name:b.name})),e={};e[b.search_conditions1[0].key]=b.search_conditions1[0].value,d.data("searchCondition",e),row.append(d)}),d.insertBefore(c.productTagPanel,c.productList.getEl())}},function(a){console.log("error",a)})},addCmpEvents:function(){k.superclass.addCmpEvents.apply(this,arguments);var b=this;b.scrollHandler=function(){if(b.scrollView.scrollTop+b.scrollView.clientHeight+107>=b.scrollView.scrollHeight)if(0==b.headerTabIndex){if(!b.productList.loadFinished){b.removeScrollListener();var c=a.later(b.productList.appendLoadingMoreSpinner,500,!1,b.productList);b.scrollView.scrollTop=b.scrollView.scrollTop+34,b.productList.loadMore(function(){c.cancel(),b.productList.removeLoadingMoreSpinner(),b.addScrollListener()})}}else if(1==b.headerTabIndex&&!b.artisanList.loadFinished){b.removeScrollListener();var c=a.later(b.artisanList.appendLoadingMoreSpinner,500,!1,b.artisanList);b.scrollView.scrollTop=b.scrollView.scrollTop+34,b.artisanList.loadMore(function(){c.cancel(),b.artisanList.removeLoadingMoreSpinner(),b.addScrollListener()})}},b.header.delegate("tap click",".tab-item:not([disabled])",function(c){var d=a.one(c.currentTarget);return d.attr("disabled","disabled"),b.setActiveHeaderTab(a.one(c.currentTarget)),d.removeAttr("disabled"),!1}),c.delegate(document,"tap click",".product-tab-body-item .tab-nav-type .tab-item-type a:not([disabled])",function(c){var e=a.one(c.currentTarget);e.attr("disabled","disabled");var f=a.one(d.parent(c.currentTarget,".tab-item-type"));return b.setProductActiveTypeTab(f),e.removeAttr("disabled"),!1}),c.delegate(document,"tap click",".artisan-tab-body-item .tab-nav-type .tab-item-type a:not([disabled])",function(c){var e=a.one(c.currentTarget);e.attr("disabled","disabled");var f=a.one(d.parent(c.currentTarget,".tab-item-type"));return b.setArtisanActiveTypeTab(f),e.removeAttr("disabled"),!1}),c.delegate(document,"tap click",".product-tab-body-item .tag-panel .tag-item a:not([disabled])",function(c){var e=a.one(c.currentTarget);e.attr("disabled","disabled");var f=a.one(d.parent(c.currentTarget,".tag-item")),g=f.data("searchCondition");if(!f.hasClass("active")){var h=a.clone(b.params);h[b.productTypeName]=b.productList.getQueryParams().filter_category,a.mix(h,g,!0),b.productList.setQueryParams(h),a.all(".tag-item").removeClass("active"),f.addClass("active"),b.productList.setActiveSortTab(0)}return e.removeAttr("disabled"),!1}),b.el.delegate("tap click","button[name=button_search]:not([disabled])",function(c){var d=a.one(c.currentTarget);if(d.attr("disabled","disabled"),b.searchModal)0===b.headerTabIndex&&b.productType.indexOf("tag_mei_jia")>-1&&b.searchModal.showProductLabels(),b.searchModal.show();else{b.searchModal=new j({animation:"slide-in-up"}),b.searchModal.on("hide",function(){b.addScrollListener&&b.addScrollListener(),d.removeAttr("disabled")}),b.searchModal.on("beforeshow",function(){b.removeScrollListener&&b.removeScrollListener()});var e={filter_type:b.artisanType||b.block.search_types2[0].value,city:b.city.code};b.searchModal.setParams(e),0===b.headerTabIndex&&b.productType.indexOf("tag_mei_jia")>-1&&b.searchModal.showProductLabels(),b.searchModal.show()}return!1}),b.el.delegate("tap click","a.card-item",function(c){var d=a.one(c.currentTarget).attr("data-id"),e={product_id:d},f=b.productHref||"../product/index.html";return e.city=b.city.name,window.location.href=f+"?"+a.param(e),!1}),b.on("changeDistrict",function(a){var c="";if(a&&a.length>0&&(c=a[0]),b.params.business_district_ids=c,b.artisanList.getQueryParams()){var d=b.artisanList.getQueryParams();d.business_district_ids=c,b.artisanList.setQueryParams(d)}if(b.productList.getQueryParams()){var d=b.productList.getQueryParams();d.business_district_ids=c,b.productList.setQueryParams(d)}0==b.headerTabIndex?b.productList.load():1==b.headerTabIndex&&b.artisanList.load()}),b.addScrollListener()}}),k},{requires:["node","event","dom","xtemplate","APP/action/Action","./ShowListFrame","APP/products/mods/ProductList","APP/artisans/mods/ArtisanList","APP/widget/search/SearchModal"]});